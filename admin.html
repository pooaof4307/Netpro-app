<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ระบบหลังบ้านโปรเน็ต</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body>
  <header>
    <h1>จัดการโปรเน็ต</h1>
  </header>

  <section class="form-section">
    <form id="addForm">
      <input type="text" name="network" placeholder="เครือข่าย (AIS)" required>
      <input type="text" name="price" placeholder="ราคา (99 บาท)" required>
      <input type="text" name="speed" placeholder="ความเร็ว (1Mbps)" required>
      <input type="text" name="duration" placeholder="ระยะเวลา (7 วัน)" required>
      <input type="text" name="description" placeholder="รายละเอียดเพิ่มเติม" required>
      <input type="text" name="link" placeholder="ลิงก์สมัคร" required>
      <button type="submit">เพิ่มโปรเน็ต</button>
    </form>
  </section>

  <section class="list-section">
    <h2>รายการโปรเน็ต</h2>
    <table id="dataTable">
      <thead>
        <tr>
          <th>เครือข่าย</th><th>ราคา</th><th>ความเร็ว</th><th>ระยะเวลา</th><th>รายละเอียด</th><th>ลิงก์</th><th>ลบ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbwV6CTBuZDmobR74BZHUJ_OFFLTO9-914I4lwASkL0LnjDsTWXzBc9trjNwZ5HxQQ8EDg/exec";

    function loadData() {
      fetch(URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#dataTable tbody");
          tbody.innerHTML = "";
          data.forEach((row, index) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${row.network}</td>
              <td>${row.price}</td>
              <td>${row.speed}</td>
              <td>${row.duration}</td>
              <td>${row.description}</td>
              <td><a href="${row.link}" target="_blank">สมัคร</a></td>
              <td><button onclick="deleteRow(${index + 2})">ลบ</button></td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    function deleteRow(rowIndex) {
      if (!confirm("คุณแน่ใจหรือไม่ว่าต้องการลบโปรเน็ตนี้?")) return;
      fetch(URL, {
        method: "POST",
        body: JSON.stringify({ delete: true, row: rowIndex }),
        headers: { "Content-Type": "application/json" }
      })
      .then(() => loadData())
      .catch(() => alert("ลบไม่สำเร็จ"));
    }

    document.getElementById("addForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = Object.fromEntries(formData.entries());
      fetch(URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(() => {
        alert("เพิ่มโปรเน็ตแล้ว");
        this.reset();
        loadData();
      })
      .catch(() => alert("เพิ่มโปรเน็ตไม่สำเร็จ"));
    });

    loadData();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>จัดการโปรเน็ตหลังบ้าน</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 900px;
    margin: 2rem auto;
    background: #f4f6f8;
    color: #222;
  }
  h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #2c3e50;
  }
  form {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    margin-bottom: 2rem;
  }
  label {
    display: block;
    margin-bottom: 0.3rem;
    font-weight: 600;
  }
  input, textarea {
    width: 100%;
    padding: 0.5rem 0.6rem;
    margin-bottom: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
    box-sizing: border-box;
  }
  textarea {
    resize: vertical;
  }
  button {
    background-color: #007bff;
    border: none;
    color: white;
    padding: 0.6rem 1.2rem;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #0056b3;
  }
  .list-container {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  }
  .package-item {
    display: flex;
    justify-content: space-between;
    padding: 0.6rem 0;
    border-bottom: 1px solid #ddd;
  }
  .package-info {
    max-width: 80%;
  }
  .package-info strong {
    font-size: 1.1rem;
  }
  .package-info small {
    color: #555;
  }
  .btn-delete {
    background-color: #dc3545;
    border: none;
    color: white;
    padding: 0.3rem 0.7rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    align-self: center;
  }
  .btn-delete:hover {
    background-color: #b02a37;
  }
  #msg {
    text-align: center;
    margin-bottom: 1rem;
    font-weight: 600;
  }
  #msg.success {
    color: #28a745;
  }
  #msg.error {
    color: #dc3545;
  }
</style>
</head>
<body>

<h1>ระบบจัดการโปรเน็ต (Admin)</h1>

<div id="msg"></div>

<form id="addPackageForm">
  <label for="network">ชื่อเครือข่าย</label>
  <input type="text" id="network" name="network" placeholder="เช่น AIS, TrueMove" required />

  <label for="price">ราคา (บาท)</label>
  <input type="number" id="price" name="price" placeholder="เช่น 199" required min="1" />

  <label for="speed">ความเร็ว</label>
  <input type="text" id="speed" name="speed" placeholder="เช่น 4G Unlimited" required />

  <label for="duration">ระยะเวลา</label>
  <input type="text" id="duration" name="duration" placeholder="เช่น 30 วัน" required />

  <label for="description">รายละเอียดเพิ่มเติม</label>
  <textarea id="description" name="description" placeholder="ใส่รายละเอียดเพิ่มเติม (ถ้ามี)" rows="3"></textarea>

  <button type="submit">เพิ่มโปรเน็ต</button>
</form>

<div class="list-container" id="packageList">
  กำลังโหลดข้อมูล...
</div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxuFiHXVxbcDiw4Y0q0cLFPhFEG5etsgQ61gmGiDjOyurNAhE-Rl3AIu7kPVP_jsJnqWg/exec';

  const form = document.getElementById('addPackageForm');
  const listContainer = document.getElementById('packageList');
  const msg = document.getElementById('msg');

  // โหลดข้อมูลโปรเน็ต
  async function loadPackages() {
    listContainer.innerHTML = 'กำลังโหลดข้อมูล...';
    try {
      const res = await fetch(scriptURL);
      if (!res.ok) throw new Error('ไม่สามารถโหลดข้อมูลได้');
      const data = await res.json();
      const packages = data.records || data;
      if (!packages.length) {
        listContainer.innerHTML = '<p>ยังไม่มีโปรเน็ตในระบบ</p>';
        return;
      }
      listContainer.innerHTML = '';
      packages.forEach(pkg => {
        const id = pkg.id || pkg.row || '';
        const item = document.createElement('div');
        item.className = 'package-item';
        item.innerHTML = `
          <div class="package-info">
            <strong>${pkg.network || '-'}</strong><br/>
            <small>ราคา: ${pkg.price || '-'} บาท | ความเร็ว: ${pkg.speed || '-'} | ระยะเวลา: ${pkg.duration || '-'}</small><br/>
            <small>รายละเอียด: ${pkg.description || '-'}</small>
          </div>
          <button class="btn-delete" data-id="${id}">ลบ</button>
        `;
        listContainer.appendChild(item);
      });
      attachDeleteListeners();
    } catch (error) {
      listContainer.innerHTML = `<p style="color:red;">${error.message}</p>`;
    }
  }

  // ผูก event ลบ
  function attachDeleteListeners() {
    const deleteButtons = document.querySelectorAll('.btn-delete');
    deleteButtons.forEach(btn => {
      btn.addEventListener('click', async e => {
        const id = e.target.getAttribute('data-id');
        if (!id) return alert('ไม่พบข้อมูลที่จะลบ');
        if (!confirm('ยืนยันการลบโปรเน็ตนี้?')) return;

        try {
          const res = await fetch(scriptURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'delete', id })
          });
          const result = await res.json();
          if (result.success) {
            showMessage('ลบโปรเน็ตเรียบร้อย', true);
            loadPackages();
          } else {
            throw new Error(result.error || 'ลบไม่สำเร็จ');
          }
        } catch (error) {
          showMessage(error.message, false);
        }
      });
    });
  }

  // เพิ่มโปรเน็ต
  form.addEventListener('submit', async e => {
    e.preventDefault();
    clearMessage();

    const network = form.network.value.trim();
    const price = form.price.value.trim();
    const speed = form.speed.value.trim();
    const duration = form.duration.value.trim();
    const description = form.description.value.trim();

    if (!network || !price || !speed || !duration) {
      showMessage('กรุณากรอกข้อมูลให้ครบถ้วน', false);
      return;
    }

    const data = {
      action: 'add',
      network,
      price,
      speed,
      duration,
      description
    };

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      const result = await res.json();
      if (result.success) {
        showMessage('เพิ่มโปรเน็ตเรียบร้อย', true);
        form.reset();
        loadPackages();
      } else {
        throw new Error(result.error || 'เพิ่มโปรเน็ตไม่สำเร็จ');
      }
    } catch (error) {
      showMessage(error.message, false);
    }
  });

  function showMessage(text, success=true) {
    msg.textContent = text;
    msg.className = success ? 'success' : 'error';
  }

  function clearMessage() {
    msg.textContent = '';
    msg.className = '';
  }

  loadPackages();
</script>

</body>
</html>

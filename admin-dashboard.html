<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบจัดการโปรเน็ต</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>จัดการโปรเน็ต</h1>
    <a href="admin-login.html">ออกจากระบบ</a>
  </header>

  <main>
    <form id="addForm">
      <input type="text" id="network" placeholder="เครือข่าย (AIS)" required>
      <input type="text" id="price" placeholder="ราคา (99 บาท)" required>
      <input type="text" id="speed" placeholder="ความเร็ว (1Mbps)" required>
      <input type="text" id="duration" placeholder="ระยะเวลา (7 วัน)" required>
      <input type="text" id="description" placeholder="รายละเอียด" required>
      <input type="text" id="link" placeholder="ลิงก์สมัคร" required>
      <button type="submit">เพิ่มโปรเน็ต</button>
    </form>

    <section id="dataList"></section>
  </main>

  <script>
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbyV7B2AfgmmULrTdOPbI6oRbJtF3FRM6_4vvHOrJBvrutWKKH0yaa0gEWRyz95cd4gy8Q/exec";

    document.getElementById("addForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const data = {
        network: this.network.value,
        price: this.price.value,
        speed: this.speed.value,
        duration: this.duration.value,
        description: this.description.value,
        link: this.link.value
      };

      fetch(SHEET_API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(() => {
        alert("เพิ่มโปรเน็ตสำเร็จ");
        this.reset();
        loadData(); // โหลดใหม่
      })
      .catch(err => {
        alert("เกิดข้อผิดพลาด: " + err.message);
      });
    });

    function loadData() {
      fetch(SHEET_API_URL)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("dataList");
          container.innerHTML = "";
          data.forEach((item, index) => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
              <h3>${item.network} - ${item.price}</h3>
              <p><strong>ความเร็ว:</strong> ${item.speed}</p>
              <p><strong>ระยะเวลา:</strong> ${item.duration}</p>
              <p>${item.description}</p>
              <a href="${item.link}" target="_blank">ลิงก์สมัคร</a>
              <button onclick="deleteItem(${index})">ลบ</button>
            `;
            container.appendChild(card);
          });
        });
    }

    function deleteItem(index) {
      fetch(SHEET_API_URL + `?delete=${index}`, { method: "GET" })
        .then(res => res.text())
        .then(() => {
          alert("ลบข้อมูลแล้ว");
          loadData();
        });
    }

    loadData();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ระบบจัดการโปรเน็ต (Admin)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  body {
    font-family: 'Inter', sans-serif;
    background: #f8f9fa;
    margin: 0; padding: 1rem;
    color: #333;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #2c3e50;
  }

  form {
    background: #fff;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgb(0 0 0 / 0.1);
    margin-bottom: 2rem;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.4rem;
    color: #34495e;
  }

  input[type=text], input[type=number], textarea {
    width: 100%;
    padding: 0.5rem 0.6rem;
    margin-bottom: 1.1rem;
    border: 1px solid #ced4da;
    border-radius: 5px;
    font-size: 1rem;
    resize: vertical;
  }

  button {
    background-color: #27ae60;
    color: white;
    padding: 0.7rem 1.3rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #219150;
  }

  .list {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgb(0 0 0 / 0.1);
    padding: 1rem;
  }

  .item {
    border-bottom: 1px solid #ddd;
    padding: 0.9rem 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .item:last-child {
    border-bottom: none;
  }

  .info {
    max-width: 75%;
  }
  .info strong {
    display: block;
    font-size: 1.1rem;
    color: #2c3e50;
  }
  .info small {
    color: #666;
    font-size: 0.9rem;
  }

  .btn-delete {
    background-color: #e74c3c;
    border: none;
    color: white;
    padding: 0.4rem 0.7rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  .btn-delete:hover {
    background-color: #c0392b;
  }

  #message {
    margin-bottom: 1rem;
    font-weight: 600;
    color: #27ae60;
    text-align: center;
  }
  #error {
    margin-bottom: 1rem;
    font-weight: 600;
    color: #e74c3c;
    text-align: center;
  }
</style>
</head>
<body>

<h1>ระบบจัดการโปรเน็ต (Admin)</h1>

<div id="message"></div>
<div id="error"></div>

<form id="addForm">
  <label for="network">ชื่อเครือข่าย</label>
  <input type="text" id="network" name="network" placeholder="เช่น AIS, TrueMove, dtac" required />

  <label for="price">ราคา (บาท)</label>
  <input type="number" id="price" name="price" placeholder="เช่น 199" required min="1" />

  <label for="speed">ความเร็ว (เช่น 4G/5G Unlimited)</label>
  <input type="text" id="speed" name="speed" placeholder="เช่น 4G Unlimited" required />

  <label for="duration">ระยะเวลา (เช่น 30 วัน)</label>
  <input type="text" id="duration" name="duration" placeholder="เช่น 30 วัน" required />

  <label for="description">รายละเอียดเพิ่มเติม</label>
  <textarea id="description" name="description" placeholder="ใส่รายละเอียดเพิ่มเติม (ถ้ามี)" rows="3"></textarea>

  <button type="submit">เพิ่มโปรเน็ต</button>
</form>

<div class="list" id="packageList">
  <!-- รายการโปรเน็ตจะขึ้นที่นี่ -->
</div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxuFiHXVxbcDiw4Y0q0cLFPhFEG5etsgQ61gmGiDjOyurNAhE-Rl3AIu7kPVP_jsJnqWg/exec';

  const form = document.getElementById('addForm');
  const listEl = document.getElementById('packageList');
  const messageEl = document.getElementById('message');
  const errorEl = document.getElementById('error');

  // โหลดรายการโปรเน็ต
  async function loadPackages() {
    listEl.innerHTML = 'กำลังโหลดข้อมูล...';
    try {
      const res = await fetch(scriptURL);
      if (!res.ok) throw new Error('เกิดข้อผิดพลาดในการโหลดข้อมูล');
      const data = await res.json();
      const packages = data.records || data;
      if (!packages.length) {
        listEl.innerHTML = '<p>ยังไม่มีโปรเน็ตในระบบ</p>';
        return;
      }
      listEl.innerHTML = '';
      packages.forEach(pkg => {
        const item = document.createElement('div');
        item.className = 'item';
        item.innerHTML = `
          <div class="info">
            <strong>${pkg.network || '-'}</strong>
            <small>ราคา: ${pkg.price || '-'} บาท | ความเร็ว: ${pkg.speed || '-'} | ระยะเวลา: ${pkg.duration || '-'}</small>
            <small>รายละเอียด: ${pkg.description || '-'}</small>
          </div>
          <button class="btn-delete" data-id="${pkg.id || pkg.row || ''}">ลบ</button>
        `;
        listEl.appendChild(item);
      });
      attachDeleteListeners();
    } catch (err) {
      listEl.innerHTML = '<p>ไม่สามารถโหลดข้อมูลได้</p>';
      console.error(err);
    }
  }

  // ลบโปรเน็ต
  async function deletePackage(id) {
    if (!id) return alert('ไม่พบข้อมูล ID สำหรับลบ');
    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'delete', id })
      });
      const result = await res.json();
      if (result.success) {
        messageEl.textContent = 'ลบโปรเน็ตเรียบร้อยแล้ว';
        errorEl.textContent = '';
        loadPackages();
      } else {
        throw new Error(result.error || 'ลบไม่สำเร็จ');
      }
    } catch (err) {
      errorEl.textContent = 'เกิดข้อผิดพลาด: ' + err.message;
      messageEl.textContent = '';
      console.error(err);
    }
  }

  // เพิ่มโปรเน็ต
  form.addEventListener('submit', async e => {
    e.preventDefault();
    messageEl.textContent = '';
    errorEl.textContent = '';

    const formData = {
      action: 'add',
      network: form.network.value.trim(),
      price: form.price.value.trim(),
      speed: form.speed.value.trim(),
      duration: form.duration.value.trim(),
      description: form.description.value.trim()
    };

    if (!formData.network || !formData.price || !formData.speed || !formData.duration) {
      errorEl.textContent = 'กรุณากรอกข้อมูลให้ครบถ้วน';
      return;
    }

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      const result = await res.json();
      if (result.success) {
        messageEl.textContent = 'เพิ่มโปรเน็ตเรียบร้อยแล้ว';
        errorEl.textContent = '';
        form.reset();
        loadPackages();
      } else {
        throw new Error(result.error || 'เพิ่มโปรเน็ตไม่สำ
